local Workspace = cloneref(game:GetService("Workspace"))
local RunService = cloneref(game:GetService("RunService"))
local Camera = Workspace.CurrentCamera

-- FOV Circles
local fov_circle_outer = Drawing.new("Circle")
fov_circle_outer.Visible = true
fov_circle_outer.Thickness = 3
fov_circle_outer.Color = Color3.fromRGB(0, 0, 0)
fov_circle_outer.Position = Camera.ViewportSize / 2
fov_circle_outer.Radius = 86

local fov_circle_inner = Drawing.new("Circle")
fov_circle_inner.Visible = true
fov_circle_inner.Thickness = 1
fov_circle_inner.Color = Color3.fromRGB(144, 238, 144)
fov_circle_inner.Position = Camera.ViewportSize / 2
fov_circle_inner.Radius = 85

-- Silent Aim Settings
local Settings = {
    ["Combat"] = {
        ["Aimbot"] = {
            ["Enabled"]    = true,
            ["Target"]     = "Head",
            ["Fov Size"]   = 85,
            ["Resolver"]   = false,
        }
    },
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Function to get closest enemy in FOV
function GetClosestTarget(maxDistance)
    local closestTarget, closestDistance = nil, math.huge
    local viewportCenter = Camera.ViewportSize / 2

    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local head = v.Character:FindFirstChild("Head")
            local distanceToPlayer = (v.Character.HumanoidRootPart.Position - Camera.CFrame.Position).Magnitude

            if head and distanceToPlayer <= maxDistance then
                local screenPoint, onScreen = Camera:WorldToViewportPoint(head.Position)
                local distanceFromCenter = (Vector2.new(screenPoint.X, screenPoint.Y) - viewportCenter).Magnitude

                if onScreen and distanceFromCenter < closestDistance and distanceFromCenter < fov_circle_inner.Radius then
                    closestTarget = head
                    closestDistance = distanceFromCenter
                end
            end
        end
    end
    return closestTarget
end

-- Magic Bullet Hook
local oldfromOrientation
oldfromOrientation = hookfunction(CFrame.fromOrientation, newcclosure(function(p, y, r)
    if debug.info(3, "n") == "fire" then
        local target = GetClosestTarget(1200)

        if target then
            -- Bullet instantly teleports to the enemy's head
            return Camera.CFrame:Inverse() * CFrame.lookAt(Camera.CFrame.Position, target.Position)
        end
    end

    return oldfromOrientation(p, y, r)
end))
